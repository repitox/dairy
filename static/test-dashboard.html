<!DOCTYPE html>
<html class="dark-theme" lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –¥–∞—à–±–æ—Ä–¥–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="auth-check.js?v=13"></script>
    <link rel="stylesheet" href="webapp-styles.css?v=13">
</head>
<body>
    <div class="unified-page-container">
        <div class="unified-page-header">
            <h1 class="unified-page-title">
                <span class="unified-page-title-icon">üè†</span>
                <span class="unified-page-title-text">–¢–µ—Å—Ç –¥–∞—à–±–æ—Ä–¥–∞</span>
            </h1>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-column">
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>üìã –ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                    </div>
                    <div class="section-content">
                        <div id="today-tasks" class="card-content">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <div>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-column">
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>üìÖ –°–æ–±—ã—Ç–∏—è</h3>
                    </div>
                    <div class="section-content">
                        <div id="today-events" class="card-content">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>üõí –ü–æ–∫—É–ø–∫–∏</h3>
                    </div>
                    <div class="section-content">
                        <div id="today-shopping" class="card-content">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <div>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∫—É–ø–æ–∫...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');

        async function testLoadData() {
            console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            
            try {
                const userId = await getDbUserId();
                console.log('üë§ DB User ID –ø–æ–ª—É—á–µ–Ω:', userId);
                
                if (!userId) {
                    console.error('‚ùå DB User ID –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }

                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π API –æ—Ç–¥–µ–ª—å–Ω–æ
                console.log('üìã –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞—á–∏...');
                const tasksResponse = await fetch(`/api/tasks/today?user_id=${userId}`);
                console.log('üìã –û—Ç–≤–µ—Ç –∑–∞–¥–∞—á:', tasksResponse.status);
                const tasks = await tasksResponse.json();
                console.log('üìã –î–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á:', tasks);
                document.getElementById('today-tasks').innerHTML = `<pre>${JSON.stringify(tasks, null, 2)}</pre>`;

                console.log('üìÖ –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–±—ã—Ç–∏—è...');
                const eventsResponse = await fetch(`/api/events/today?user_id=${userId}`);
                console.log('üìÖ –û—Ç–≤–µ—Ç —Å–æ–±—ã—Ç–∏–π:', eventsResponse.status);
                const events = await eventsResponse.json();
                console.log('üìÖ –î–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏–π:', events);
                document.getElementById('today-events').innerHTML = `<pre>${JSON.stringify(events, null, 2)}</pre>`;

                console.log('üõí –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–∫—É–ø–∫–∏...');
                const shoppingResponse = await fetch(`/api/shopping?user_id=${userId}`);
                console.log('üõí –û—Ç–≤–µ—Ç –ø–æ–∫—É–ø–æ–∫:', shoppingResponse.status);
                const shopping = await shoppingResponse.json();
                console.log('üõí –î–∞–Ω–Ω—ã–µ –ø–æ–∫—É–ø–æ–∫:', shopping);
                document.getElementById('today-shopping').innerHTML = `<pre>${JSON.stringify(shopping, null, 2)}</pre>`;

                console.log('‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!');

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–µ:', error);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            AuthCheck.initAuthCheck(
                (userId) => {
                    console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç");
                    testLoadData();
                },
                () => {
                    console.log("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω");
                }
            );
        });
    </script>
</body>
</html>