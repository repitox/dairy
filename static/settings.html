<!DOCTYPE html>
<html class="dark-theme" lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - Task Manager</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="auth-check.js?v=13"></script>
    <script src="webapp-navigation-loader.js"></script>
    <script src="webapp-user-resolver.js"></script>
    
    <link rel="stylesheet" href="webapp-styles.css?v=12">
</head>
<body>
    <div class="unified-page-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ —Å—Ç–∏–ª–µ dashboard -->
        <div class="unified-page-header">
            <div class="back-button" onclick="goBack()">
                <span class="back-button-icon">‚Üê</span>
                <span class="back-button-text">–ù–∞–∑–∞–¥</span>
            </div>
            <h1 class="unified-page-title">
                <span class="unified-page-title-icon">‚öôÔ∏è</span>
                <span class="unified-page-title-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </h1>
            <div class="unified-action-group">
                
                <button class="hamburger-menu" onclick="toggleNavigationMenu()">
                    <span class="hamburger-icon">‚ò∞</span>
                </button>
            </div>
        </div>

        <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="navigation-menu" id="navigation-menu">
            <div class="navigation-menu-header">
                <h3>üß≠ –ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
                <button class="close-menu" onclick="toggleNavigationMenu()">‚úï</button>
            </div>
            <div class="navigation-menu-content">
                <div class="navigation-sections">
                    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- Overlay –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é -->
        <div class="menu-overlay" id="menu-overlay" onclick="toggleNavigationMenu()"></div>

        
    <div class="unified-page-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ —Å—Ç–∏–ª–µ dashboard -->
        
        </div>

        <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        
            </div>
        </div>

        <!-- Overlay –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é -->
        

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã -->
        <section class="settings-section">
            
            <div class="section-content">
                <div class="form-group">
                    <label class="form-label" for="theme-select">–¢–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
                    <select id="theme-select" class="form-control">
                        <option value="auto">üåì –ê–≤—Ç–æ (–∫–∞–∫ –≤ —Å–∏—Å—Ç–µ–º–µ)</option>
                        <option value="light">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è</option>
                        <option value="dark">üåô –¢—ë–º–Ω–∞—è</option>
                    </select>
                </div>

                <div class="form-actions">
                    <button id="save-btn" class="btn btn-primary btn-full">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                </div>
                
                <div id="status"></div>
            </div>
        </section>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <section class="settings-section">
            
            <div class="section-content">
                <a href="timezone-settings.html" class="nav-item">
                    <span class="nav-item-icon">üïê</span>
                    –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
                </a>
            </div>
        </section>

    </div>

    <script>
    // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    function goBack() {
        if (window.history.length > 1) {
            window.history.back();
        } else {
            window.location.href = 'index.html';
        }
    }

    function toggleNavigationMenu() {
        const menu = document.getElementById('navigation-menu');
        const overlay = document.getElementById('menu-overlay');
        
        if (menu.classList.contains('open')) {
            menu.classList.remove('open');
            overlay.classList.remove('open');
        } else {
            menu.classList.add('open');
            overlay.classList.add('open');
        }
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø–æ Escape
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const menu = document.getElementById('navigation-menu');
            if (menu.classList.contains('open')) {
                toggleNavigationMenu();
            }
        }
    });
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–º –º–µ–Ω—é
        function toggleNavigationMenu() {
            const menu = document.getElementById('navigation-menu');
            const overlay = document.getElementById('menu-overlay');
            
            if (menu.classList.contains('open')) {
                menu.classList.remove('open');
                overlay.classList.remove('open');
            } else {
                menu.classList.add('open');
                overlay.classList.add('open');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø–æ Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const menu = document.getElementById('navigation-menu');
                if (menu.classList.contains('open')) {
                    toggleNavigationMenu();
                }
            }
        });
    </script>
    
    <script>
    // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    function goBack() {
        if (window.history.length > 1) {
            window.history.back();
        } else {
            window.location.href = 'index.html';
        }
    }

    function toggleNavigationMenu() {
        const menu = document.getElementById('navigation-menu');
        const overlay = document.getElementById('menu-overlay');
        
        if (menu.classList.contains('open')) {
            menu.classList.remove('open');
            overlay.classList.remove('open');
        } else {
            menu.classList.add('open');
            overlay.classList.add('open');
        }
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø–æ Escape
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const menu = document.getElementById('navigation-menu');
            if (menu.classList.contains('open')) {
                toggleNavigationMenu();
            }
        }
    });
        const tg = window.Telegram.WebApp;
        tg.expand();

        const status = document.getElementById("status");
        const themeSelect = document.getElementById("theme-select");

        async function fetchSettings() {
            const userId = tg.initDataUnsafe.user?.id;
            if (userId) {
                const r = await fetch(`/api/user/settings?user_id=${userId}`);
                if (r.ok) {
                    const { theme } = await r.json();
                    if (theme !== null && theme !== undefined) {
                        themeSelect.value = theme;
                    }
                }
            }
        }

        document.getElementById("save-btn").addEventListener("click", async () => {
            const userId = tg.initDataUnsafe.user?.id;
            if (!userId) return;

            const theme = themeSelect.value;

            try {
                const res2 = await fetch("/api/user/setting", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ user_id: userId, key: "theme", value: theme })
                });

                if (res2.ok) {
                    status.textContent = "‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ";
                } else {
                    status.textContent = "‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è";
                }
            } catch (e) {
                status.textContent = "‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–µ—Ç–∏";
            }
        });

        fetchSettings();
    </script>
    
</body>
</html>