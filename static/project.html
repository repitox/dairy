

<!DOCTYPE html>
<html class="dark-theme" lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–µ–∫—Ç - Task Manager</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="auth-check.js"></script>
    <script src="webapp-navigation-loader.js"></script>
    <script src="webapp-user-resolver.js"></script>
    
    <link rel="stylesheet" href="webapp-styles.css?v=8">
</head>
<body>
    <div class="unified-page-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ —Å—Ç–∏–ª–µ dashboard -->
        <div class="unified-page-header">
            <div class="back-button" onclick="goBack()">
                <span class="back-button-icon">‚Üê</span>
                <span class="back-button-text">–ù–∞–∑–∞–¥</span>
            </div>
            <h1 class="unified-page-title">
                <span class="unified-page-title-icon">üìÅ</span>
                <span class="unified-page-title-text">–ü—Ä–æ–µ–∫—Ç</span>
            </h1>
            <div class="unified-action-group">
                
                <button class="hamburger-menu" onclick="toggleNavigationMenu()">
                    <span class="hamburger-icon">‚ò∞</span>
                </button>
            </div>
        </div>

        <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="navigation-menu" id="navigation-menu">
            <div class="navigation-menu-header">
                <h3>üß≠ –ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
                <button class="close-menu" onclick="toggleNavigationMenu()">‚úï</button>
            </div>
            <div class="navigation-menu-content">
                <div class="navigation-sections">
                    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- Overlay –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é -->
        <div class="menu-overlay" id="menu-overlay" onclick="toggleNavigationMenu()"></div>

        
    <div class="webapp-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ —Å—Ç–∏–ª–µ dashboard -->
        <header class="header">
            <h1 class="page-title">
                <span>üìÅ</span>
                <span id="project-name">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞...</span>
            </h1>
        </header>

        <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ -->
        <section class="project-section" id="members-section">
            
            <div class="section-content">
                <ul id="members-list" class="members-list"></ul>
            </div>
        </section>

        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ -->
        <section class="project-section">
            
            <div class="section-content">
                <form id="invite-form">
                    <div class="form-group">
                        <label class="form-label" for="user-id">Telegram ID —É—á–∞—Å—Ç–Ω–∏–∫–∞</label>
                        <input type="text" id="user-id" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ Telegram ID" required />
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        –î–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç
                    </button>
                </form>
            </div>
        </section>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="dashboard-navigation">
            <a href="#" id="back-link" class="nav-item">
                <span class="nav-item-icon">‚Üê</span>
                –ù–∞–∑–∞–¥
            </a>
        </nav>
    </div>

  <script>
    // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    function goBack() {
        if (window.history.length > 1) {
            window.history.back();
        } else {
            window.location.href = 'index.html';
        }
    }

    function toggleNavigationMenu() {
        const menu = document.getElementById('navigation-menu');
        const overlay = document.getElementById('menu-overlay');
        
        if (menu.classList.contains('open')) {
            menu.classList.remove('open');
            overlay.classList.remove('open');
        } else {
            menu.classList.add('open');
            overlay.classList.add('open');
        }
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø–æ Escape
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const menu = document.getElementById('navigation-menu');
            if (menu.classList.contains('open')) {
                toggleNavigationMenu();
            }
        }
    });
    const tg = window.Telegram.WebApp;
    tg.expand();

    const userId = tg.initDataUnsafe?.user?.id;
    const projectId = new URLSearchParams(window.location.search).get("project_id");

    async function loadProject() {
      const res = await fetch(`/api/project?id=${projectId}`);
      if (res.ok) {
        const data = await res.json();
        document.getElementById("project-name").textContent = data.name;
      } else {
        document.getElementById("project-name").textContent = "–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω";
      }
    }

    document.getElementById("invite-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const invitedId = document.getElementById("user-id").value;
      const res = await fetch(`/api/project/invite`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ project_id: projectId, user_id: invitedId })
      });
      if (res.ok) {
        alert("–£—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω");
        document.getElementById("user-id").value = "";
      } else {
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞");
      }
    });

    document.getElementById("back-link").href = `index.html?project_id=${projectId}`;
    loadProject();
    loadMembers();

    async function loadMembers() {
      const res = await fetch(`/api/project/members?id=${projectId}`);
      const list = document.getElementById("members-list");
      list.innerHTML = "";

      if (res.ok) {
        const members = await res.json();
        if (members.length === 0) {
          list.innerHTML = "<li>–ù–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</li>";
        } else {
          for (const member of members) {
            const li = document.createElement("li");
            li.textContent = `ID: ${member.user_id}`;
            list.appendChild(li);
          }
        }
      } else {
        list.innerHTML = "<li>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</li>";
      }
    }
  </script>
  
</body>
</html>