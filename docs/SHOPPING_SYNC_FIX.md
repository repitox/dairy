# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–∫—É–ø–æ–∫ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (main.html) –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –ø–æ–∫—É–ø–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–∫—É–ø–æ–∫ (shopping.html). –≠—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –ø—É—Ç–∞–Ω–∏—Ü—É –∏ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.

## –ü—Ä–∏—á–∏–Ω–∞

–í —Å–∏—Å—Ç–µ–º–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∏ **–¥–≤–µ —Ä–∞–∑–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –ø–æ–∫—É–ø–æ–∫**:

### 1. –¢–∞–±–ª–∏—Ü–∞ `shopping` (—Å—Ç–∞—Ä–∞—è)
```sql
CREATE TABLE shopping (
    id INTEGER,
    user_id INTEGER,
    project_id INTEGER,
    item TEXT,
    quantity INTEGER,
    status TEXT,
    created_at TEXT
);
```
- **–°—Ç–∞—Ç—É—Å**: –ü—É—Å—Ç–∞—è (0 –∑–∞–ø–∏—Å–µ–π)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –≤**: `get_recent_purchases()` –¥–ª—è scheduler.py

### 2. –¢–∞–±–ª–∏—Ü–∞ `purchases` (–Ω–æ–≤–∞—è)
```sql
CREATE TABLE purchases (
    id INTEGER,
    user_id INTEGER,
    project_id INTEGER,
    name TEXT,
    quantity INTEGER,
    price NUMERIC,
    category TEXT,
    completed BOOLEAN,
    created_at TEXT,
    shopping_list_id INTEGER,
    url TEXT,
    comment TEXT
);
```
- **–°—Ç–∞—Ç—É—Å**: –°–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ (3 –∑–∞–ø–∏—Å–∏)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –≤**: 
  - `get_shopping_items()` –¥–ª—è main.html
  - `get_shopping_items_by_lists()` –¥–ª—è shopping.html

## –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º

| –°—Ç—Ä–∞–Ω–∏—Ü–∞ | API Endpoint | –§—É–Ω–∫—Ü–∏—è DB | –¢–∞–±–ª–∏—Ü–∞ | –°—Ç–∞—Ç—É—Å |
|----------|-------------|------------|---------|--------|
| main.html | `/api/shopping` | `get_shopping_items()` | `purchases` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| shopping.html | `/api/shopping-by-lists` | `get_shopping_items_by_lists()` | `purchases` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| scheduler.py | - | `get_recent_purchases()` | `shopping` | ‚ùå –ü—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞ |

## –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_recent_purchases()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã `purchases`:

### –ë—ã–ª–æ:
```python
def get_recent_purchases(user_id: int, limit: int = 5):
    with get_conn() as conn:
        with conn.cursor() as cur:
            cur.execute("""
                SELECT id, item, quantity, status, created_at
                FROM shopping  -- ‚ùå –°—Ç–∞—Ä–∞—è –ø—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞
                WHERE status = '–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å'
                  AND (
                      (user_id = %s AND project_id IS NULL)
                      OR project_id IN (
                          SELECT project_id FROM project_members WHERE user_id = %s
                      )
                  )
                ORDER BY created_at DESC
                LIMIT %s
            """, (db_user_id, db_user_id, limit))
            return cur.fetchall()
```

### –°—Ç–∞–ª–æ:
```python
def get_recent_purchases(user_id: int, limit: int = 5):
    with get_conn() as conn:
        with conn.cursor() as cur:
            cur.execute("""
                SELECT 
                    p.id, 
                    p.name as item, 
                    p.name as title,
                    p.quantity, 
                    CASE WHEN p.completed THEN '–ö—É–ø–ª–µ–Ω–æ' ELSE '–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å' END as status,
                    p.completed as is_done,
                    p.created_at,
                    p.price,
                    p.category
                FROM purchases p  -- ‚úÖ –ù–æ–≤–∞—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
                WHERE p.completed = FALSE
                  AND p.user_id = %s
                ORDER BY p.created_at DESC
                LIMIT %s
            """, (db_user_id, limit))
            return cur.fetchall()
```

## –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
1. **–ï–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö**: –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–∞–±–ª–∏—Ü—É `purchases`
2. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–æ–ª–µ–π**: –î–æ–±–∞–≤–ª–µ–Ω—ã –∞–ª–∏–∞—Å—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
3. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `completed = FALSE` –≤–º–µ—Å—Ç–æ `status = '–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å'`
4. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è**: –î–æ–±–∞–≤–ª–µ–Ω—ã `price` –∏ `category` –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö

### üîÑ –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π
| –°—Ç–∞—Ä–æ–µ –ø–æ–ª–µ | –ù–æ–≤–æ–µ –ø–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------------|------------|----------|
| `item` | `p.name as item` | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ |
| `status` | `CASE WHEN p.completed...` | –°—Ç–∞—Ç—É—Å –ø–æ–∫—É–ø–∫–∏ |
| - | `p.name as title` | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ |
| - | `p.completed as is_done` | –ë—É–ª–µ–≤–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ |
| - | `p.price` | –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ |
| - | `p.category` | –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞ |

## –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
üîç –ü–æ–∫—É–ø–∫–∏ –¥–ª—è 123456789: []
üõí –ü–æ–∫—É–ø–∫–∏: –í—Å—ë –∫—É–ø–ª–µ–Ω–æ! ‚úÖ
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
üîç –ü–æ–∫—É–ø–∫–∏ –¥–ª—è 123456789: [
    RealDictRow([('id', 3), ('item', '–ú—è—Å–æ'), ('title', '–ú—è—Å–æ'), ('quantity', 1), ('status', '–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å'), ...]),
    RealDictRow([('id', 2), ('item', '–•–ª–µ–±'), ('title', '–•–ª–µ–±'), ('quantity', 1), ('status', '–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å'), ...]),
    RealDictRow([('id', 1), ('item', '–ú–æ–ª–æ–∫–æ 3.2%'), ('title', '–ú–æ–ª–æ–∫–æ 3.2%'), ('quantity', 1), ('status', '–ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å'), ...])
]

üõí –ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å:
‚ñ™Ô∏è 1 √ó –ú—è—Å–æ
‚ñ™Ô∏è 1 √ó –•–ª–µ–±
‚ñ™Ô∏è 1 √ó –ú–æ–ª–æ–∫–æ 3.2%
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–¢–µ–ø–µ—Ä—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:

### 1. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (main.html)
- **URL**: http://localhost:8000/dashboard/main.html
- **API**: `/api/shopping?user_id=${userId}`
- **–§—É–Ω–∫—Ü–∏—è**: `get_shopping_items()`
- **–¢–∞–±–ª–∏—Ü–∞**: `purchases` ‚úÖ

### 2. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫—É–ø–æ–∫ (shopping.html)  
- **URL**: http://localhost:8000/dashboard/shopping.html
- **API**: `/api/shopping-by-lists?user_id=${userId}`
- **–§—É–Ω–∫—Ü–∏—è**: `get_shopping_items_by_lists()`
- **–¢–∞–±–ª–∏—Ü–∞**: `purchases` ‚úÖ

### 3. –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ (scheduler.py)
- **–§—É–Ω–∫—Ü–∏—è**: `get_recent_purchases()`
- **–¢–∞–±–ª–∏—Ü–∞**: `purchases` ‚úÖ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
–§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º:
- `item` –∏ `title` - –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –Ω–∞–∑–≤–∞–Ω–∏—é
- `status` - —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `is_done` - –±—É–ª–µ–≤–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ª–æ–≥–∏–∫–∏
- `price` –∏ `category` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –£–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ (–ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –ø–æ `user_id` –∏ `completed = FALSE`
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- **–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: ~30 –º–∏–Ω—É—Ç
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–æ**: 20
- **–§—É–Ω–∫—Ü–∏–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: 1 (`get_recent_purchases`)
- **–¢–∞–±–ª–∏—Ü –æ–±—ä–µ–¥–∏–Ω–µ–Ω–æ**: 2 ‚Üí 1
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –í—ã—Å–æ–∫–∞—è (–Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö)

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 2025-01-27  
**–í–µ—Ä—Å–∏—è**: v3.0.3  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ