# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## ‚úÖ –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. –§—É–Ω–∫—Ü–∏—è `add_user()` - –ò–°–ü–†–ê–í–õ–ï–ù–ê ‚úÖ
- –ò–∑–º–µ–Ω–µ–Ω–∞ —Å `user_id` –Ω–∞ `telegram_id`
- –î–æ–±–∞–≤–ª–µ–Ω `RETURNING id` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ ID
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –ª–∏—á–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### 2. –§—É–Ω–∫—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –ò–°–ü–†–ê–í–õ–ï–ù–´ ‚úÖ
- `update_user_setting()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `resolve_user_id()`
- `get_user_settings()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `resolve_user_id()`
- `get_user_setting()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `resolve_user_id()`

### 3. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ - –î–û–ë–ê–í–õ–ï–ù–´ ‚úÖ
- `get_user_internal_id()` - –ø–æ–ª—É—á–µ–Ω–∏–µ internal_id –ø–æ telegram_id
- `resolve_user_id()` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ internal_id
- `get_personal_project_id()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

## ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

### 1. –§—É–Ω–∫—Ü–∏–∏ –∑–∞–¥–∞—á:
- `add_task(user_id, ...)` - –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `resolve_user_id()`
- `get_tasks(user_id, ...)` - –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã
- `get_overdue_tasks(user_id)` - –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã

### 2. –§—É–Ω–∫—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π:
- `add_event(user_id, ...)` - –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `resolve_user_id()`
- `get_events(user_id)` - –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã
- `get_upcoming_events(user_id)` - –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã

### 3. –§—É–Ω–∫—Ü–∏–∏ –ø–æ–∫—É–ø–æ–∫:
- `add_purchase(user_id, ...)` - –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `resolve_user_id()`
- `get_recent_purchases(user_id, ...)` - –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã

### 4. –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤:
- `get_project(project_id, user_id)` - –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ `user_id`

## üéØ –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Å–µ–π—á–∞—Å)
- ‚úÖ `add_user()` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### –≠—Ç–∞–ø 2: –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Å–ª–µ–¥—É—é—â–∏–π)
- `add_task()` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–¥–∞—á
- `add_event()` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
- `add_purchase()` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∫—É–ø–æ–∫

### –≠—Ç–∞–ø 3: –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
- –§—É–Ω–∫—Ü–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤

## üîç –ö–∞–∫ –Ω–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```bash
# –ü–æ–∏—Å–∫ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å user_id –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
grep -n "def.*user_id" db.py

# –ü–æ–∏—Å–∫ –≤—Å–µ—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤ —Å user_id
grep -n "user_id.*=" db.py

# –ü–æ–∏—Å–∫ –≤—Å–µ—Ö WHERE —É—Å–ª–æ–≤–∏–π —Å user_id
grep -n "WHERE.*user_id" db.py
```

## üìù –®–∞–±–ª–æ–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

### –ë—ã–ª–æ:
```python
def some_function(user_id: int, ...):
    with get_conn() as conn:
        with conn.cursor() as cur:
            cur.execute("SELECT ... WHERE user_id = %s", (user_id,))
```

### –°—Ç–∞–ª–æ:
```python
def some_function(user_id: int, ...):
    """
    –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏. user_id –º–æ–∂–µ—Ç –±—ã—Ç—å telegram_id –∏–ª–∏ internal_id.
    """
    internal_id = resolve_user_id(user_id)
    if not internal_id:
        print(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID {user_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return None
        
    with get_conn() as conn:
        with conn.cursor() as cur:
            cur.execute("SELECT ... WHERE user_id = %s", (internal_id,))
```

## üö® –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –§—É–Ω–∫—Ü–∏—è `resolve_user_id()` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –∫–∞–∫ —Å–æ —Å—Ç–∞—Ä—ã–º–∏ telegram_id, —Ç–∞–∫ –∏ —Å –Ω–æ–≤—ã–º–∏ internal_id

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è**: –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç `resolve_user_id()` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é —Å –æ–±–æ–∏–º–∏ —Ç–∏–ø–∞–º–∏ ID

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–í—ã—Å–æ–∫–∏–π**: –§—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (`add_*`)
2. **–°—Ä–µ–¥–Ω–∏–π**: –§—É–Ω–∫—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (`get_*`)
3. **–ù–∏–∑–∫–∏–π**: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å:

- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: 100% (3/3 —Ñ—É–Ω–∫—Ü–∏–∏)
- ‚è≥ –ó–∞–¥–∞—á–∏: 0% (0/5 —Ñ—É–Ω–∫—Ü–∏–π)
- ‚è≥ –°–æ–±—ã—Ç–∏—è: 0% (0/6 —Ñ—É–Ω–∫—Ü–∏–π)
- ‚è≥ –ü–æ–∫—É–ø–∫–∏: 0% (0/3 —Ñ—É–Ω–∫—Ü–∏–∏)
- ‚è≥ –ü—Ä–æ–µ–∫—Ç—ã: 0% (0/8 —Ñ—É–Ω–∫—Ü–∏–π)

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å: 12% (3/25 —Ñ—É–Ω–∫—Ü–∏–π)**