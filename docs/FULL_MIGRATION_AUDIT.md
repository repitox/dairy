# üîç –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

## üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–í—Å–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–π —Å user_id:** 25  
**–£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 25 (100%) ‚úÖ  
**–¢—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 0 (0%) üéâ

## ‚úÖ –í–°–ï –§–£–ù–ö–¶–ò–ò –ò–°–ü–†–ê–í–õ–ï–ù–´! (25 —Ñ—É–Ω–∫—Ü–∏–π)

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
1. ‚úÖ `add_user()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. ‚úÖ `resolve_user_id()` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ internal_id
3. ‚úÖ `get_user_internal_id()` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è telegram_id
4. ‚úÖ `update_user_setting()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
5. ‚úÖ `get_user_settings()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
6. ‚úÖ `get_user_setting()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ó–∞–¥–∞—á–∏ (–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï):
7. ‚úÖ `add_task()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á
8. ‚úÖ `get_tasks()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á
9. ‚úÖ `get_today_tasks()` - –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

### –°–æ–±—ã—Ç–∏—è (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢):
10. ‚úÖ `add_event()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
11. ‚úÖ `update_event()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
12. ‚úÖ `get_events_by_filter()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –ø–æ —Ñ–∏–ª—å—Ç—Ä—É
13. ‚úÖ `get_today_events()` - —Å–æ–±—ã—Ç–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
14. ‚úÖ `has_reminder_been_sent()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
15. ‚úÖ `record_reminder_sent()` - –∑–∞–ø–∏—Å—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

### –ü–æ–∫—É–ø–∫–∏ (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢):
16. ‚úÖ `add_purchase()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫—É–ø–æ–∫
17. ‚úÖ `get_recent_purchases()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–∫—É–ø–æ–∫
18. ‚úÖ `add_shopping_item()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Å–ø–∏—Å–æ–∫
19. ‚úÖ `get_shopping_items()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–æ–µ–∫—Ç—ã:
20. ‚úÖ `add_project_member()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–ò–°–ü–†–ê–í–õ–ï–ù–ê –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê!)
21. ‚úÖ `get_project()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤
22. ‚úÖ `get_user_projects()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
23. ‚úÖ `delete_project()` - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

### –°–ø–∏—Å–∫–∏ –ø–æ–∫—É–ø–æ–∫:
24. ‚úÖ `create_shopping_list()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫

### –ó–∞–º–µ—Ç–∫–∏:
25. ‚úÖ `add_note()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫

## üéâ –í–°–ï –§–£–ù–ö–¶–ò–ò –ò–°–ü–†–ê–í–õ–ï–ù–´!

### üõí –ü–û–ö–£–ü–ö–ò (3 —Ñ—É–Ω–∫—Ü–∏–∏) - –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
1. **`add_purchase(user_id, project_id, item, quantity)`** - —Å—Ç—Ä–æ–∫–∞ 329
   ```sql
   INSERT INTO shopping (user_id, project_id, item, quantity, status, created_at)
   ```

2. **`get_recent_purchases(user_id, limit=5)`** - —Å—Ç—Ä–æ–∫–∞ 359
   ```sql
   WHERE (user_id = %s AND project_id IS NULL)
   OR project_id IN (SELECT project_id FROM project_members WHERE user_id = %s)
   ```

3. **`add_purchase_item(user_id, name, quantity, ...)`** - —Å—Ç—Ä–æ–∫–∞ 976
   ```sql
   INSERT INTO purchases (user_id, name, quantity, ...)
   ```

### ‚úÖ –°–û–ë–´–¢–ò–Ø - –£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–´!
~~4. `add_event()` - –ò–°–ü–†–ê–í–õ–ï–ù–ê~~
~~5. `update_event()` - –ò–°–ü–†–ê–í–õ–ï–ù–ê~~
~~6. `get_events_by_filter()` - –ò–°–ü–†–ê–í–õ–ï–ù–ê~~
~~7. `get_today_events()` - –ò–°–ü–†–ê–í–õ–ï–ù–ê~~
~~8. `has_reminder_been_sent()` - –ò–°–ü–†–ê–í–õ–ï–ù–ê~~
~~9. `record_reminder_sent()` - –ò–°–ü–†–ê–í–õ–ï–ù–ê~~

### ‚úÖ –ó–ê–î–ê–ß–ò - –£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–´!
~~10. `add_task()` - –ò–°–ü–†–ê–í–õ–ï–ù–ê~~
~~11. `get_tasks()` - –ò–°–ü–†–ê–í–õ–ï–ù–ê~~
~~12. `get_today_tasks()` - –ò–°–ü–†–ê–í–õ–ï–ù–ê~~

### üìÅ –ü–†–û–ï–ö–¢–´ (5 —Ñ—É–Ω–∫—Ü–∏–π) - –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
13. **`get_project(project_id, user_id=None)`** - —Å—Ç—Ä–æ–∫–∞ 750
    ```sql
    AND (p.owner_id = %s OR p.id IN (
        SELECT pm.project_id FROM project_members pm WHERE pm.user_id = %s
    ))
    ```

14. **`get_user_projects(user_id)`** - —Å—Ç—Ä–æ–∫–∞ 770
    ```sql
    WHERE (p.owner_id = %s OR p.id IN (
        SELECT pm.project_id FROM project_members pm WHERE pm.user_id = %s
    ))
    ```

15. **`delete_project(project_id, user_id)`** - —Å—Ç—Ä–æ–∫–∞ 712
    ```sql
    AND (p.owner_id = %s OR p.id IN (
        SELECT pm.project_id FROM project_members pm WHERE pm.user_id = %s
    ))
    ```

16. **`has_project_access(project_id, user_id)`** - —Å—Ç—Ä–æ–∫–∞ 800
    ```sql
    AND (p.owner_id = %s OR p.id IN (
        SELECT pm.project_id FROM project_members pm WHERE pm.user_id = %s
    ))
    ```

17. **`add_project_member(project_id, member_user_id, user_id)`** - —Å—Ç—Ä–æ–∫–∞ 835
    ```sql
    SELECT 1 FROM users WHERE user_id = %s  -- –û–®–ò–ë–ö–ê! –î–æ–ª–∂–Ω–æ –±—ã—Ç—å telegram_id
    INSERT INTO project_members (project_id, user_id, joined_at)
    ```

### üõçÔ∏è –°–ü–ò–°–ö–ò –ü–û–ö–£–ü–û–ö (2 —Ñ—É–Ω–∫—Ü–∏–∏) - –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
18. **`create_shopping_list(name, project_id, user_id)`** - —Å—Ç—Ä–æ–∫–∞ 1055
    ```sql
    INSERT INTO shopping_lists (name, project_id, user_id, created_at)
    ```

19. **`remove_project_member(project_id, member_user_id, user_id)`** - —Å—Ç—Ä–æ–∫–∞ 880
    ```sql
    DELETE FROM project_members WHERE project_id = %s AND user_id = %s
    ```

### üìù –ó–ê–ú–ï–¢–ö–ò (1 —Ñ—É–Ω–∫—Ü–∏—è) - –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
20. **`add_note(user_id, title, content)`** - —Å—Ç—Ä–æ–∫–∞ 1248
    ```sql
    INSERT INTO notes (user_id, title, content, created_at, updated_at)
    ```

## üéØ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô –ü–û –ü–†–ò–û–†–ò–¢–ï–¢–ê–ú

### üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô (3 —Ñ—É–Ω–∫—Ü–∏–∏) - –°–¥–µ–ª–∞—Ç—å –ü–ï–†–í–´–ú–ò
- `add_task()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á
- `get_tasks()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á  
- `get_today_tasks()` - –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

### ‚ö° –í–´–°–û–ö–ò–ô (9 —Ñ—É–Ω–∫—Ü–∏–π) - –°–¥–µ–ª–∞—Ç—å –í–¢–û–†–´–ú–ò
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π (6 —Ñ—É–Ω–∫—Ü–∏–π)
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∫—É–ø–æ–∫ (3 —Ñ—É–Ω–∫—Ü–∏–∏)

### üìã –°–†–ï–î–ù–ò–ô (6 —Ñ—É–Ω–∫—Ü–∏–π) - –°–¥–µ–ª–∞—Ç—å –¢–†–ï–¢–¨–ò–ú–ò
- –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ (5 —Ñ—É–Ω–∫—Ü–∏–π)
- –°–ø–∏—Å–∫–∏ –ø–æ–∫—É–ø–æ–∫ (1 —Ñ—É–Ω–∫—Ü–∏—è)

### üìù –ù–ò–ó–ö–ò–ô (1 —Ñ—É–Ω–∫—Ü–∏—è) - –°–¥–µ–ª–∞—Ç—å –ü–û–°–õ–ï–î–ù–ï–ô
- –§—É–Ω–∫—Ü–∏–∏ –∑–∞–º–µ—Ç–æ–∫ (1 —Ñ—É–Ω–∫—Ü–∏—è)

## üîß –®–ê–ë–õ–û–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –î–ª—è —Ñ—É–Ω–∫—Ü–∏–π —Å INSERT:
```python
def some_function(user_id: int, ...):
    """–û–ø–∏—Å–∞–Ω–∏–µ. user_id –º–æ–∂–µ—Ç –±—ã—Ç—å telegram_id –∏–ª–∏ internal_id."""
    internal_id = resolve_user_id(user_id)
    if not internal_id:
        print(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID {user_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return None
        
    with get_conn() as conn:
        with conn.cursor() as cur:
            cur.execute("""
                INSERT INTO table_name (user_id, ...)
                VALUES (%s, ...)
            """, (internal_id, ...))
```

### –î–ª—è —Ñ—É–Ω–∫—Ü–∏–π —Å SELECT:
```python
def some_function(user_id: int, ...):
    """–û–ø–∏—Å–∞–Ω–∏–µ. user_id –º–æ–∂–µ—Ç –±—ã—Ç—å telegram_id –∏–ª–∏ internal_id."""
    internal_id = resolve_user_id(user_id)
    if not internal_id:
        return []  # –∏–ª–∏ None, –∏–ª–∏ {}
        
    with get_conn() as conn:
        with conn.cursor() as cur:
            cur.execute("""
                SELECT ... WHERE user_id = %s
                OR project_id IN (
                    SELECT project_id FROM project_members WHERE user_id = %s
                )
            """, (internal_id, internal_id))
```

## ‚ö†Ô∏è –û–°–û–ë–´–ï –°–õ–£–ß–ê–ò

### 1. –§—É–Ω–∫—Ü–∏—è `add_project_member()` - –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê!
```sql
-- –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Å—Ç—Ä–æ–∫–∞ 851):
SELECT 1 FROM users WHERE user_id = %s

-- –ü–†–ê–í–ò–õ–¨–ù–û:
SELECT 1 FROM users WHERE telegram_id = %s OR id = %s
```

### 2. –§—É–Ω–∫—Ü–∏–∏ —Å –¥–≤–æ–π–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
–ú–Ω–æ–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø—Ä–∞–≤–∞ —á–µ—Ä–µ–∑:
- `p.owner_id = %s` (–≤–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ–µ–∫—Ç–∞)
- `pm.user_id = %s` (—É—á–∞—Å—Ç–Ω–∏–∫ –ø—Ä–æ–µ–∫—Ç–∞)

–û–±–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `internal_id`!

## üìä –ü–†–û–ì–†–ï–°–° –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–Ø

- [x] **–ó–∞–¥–∞—á–∏:** 3/3 (100%) ‚úÖ
- [x] **–°–æ–±—ã—Ç–∏—è:** 6/6 (100%) ‚úÖ
- [x] **–ü–æ–∫—É–ø–∫–∏:** 4/4 (100%) ‚úÖ
- [x] **–ü—Ä–æ–µ–∫—Ç—ã:** 5/5 (100%) ‚úÖ
- [x] **–°–ø–∏—Å–∫–∏ –ø–æ–∫—É–ø–æ–∫:** 1/1 (100%) ‚úÖ
- [x] **–ó–∞–º–µ—Ç–∫–∏:** 1/1 (100%) ‚úÖ

**–û–ë–©–ò–ô –ü–†–û–ì–†–ï–°–°: 25/25 (100%) üéâ –ó–ê–í–ï–†–®–ï–ù–û!**

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ - –í–°–ï –†–ï–®–ï–ù–´! ‚úÖ

1. ‚úÖ ~~**–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**~~ - **–ò–°–ü–†–ê–í–õ–ï–ù–û!**
2. ‚úÖ ~~**–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**~~ - **–ò–°–ü–†–ê–í–õ–ï–ù–û!**
3. ‚úÖ ~~**–ü–æ–∫—É–ø–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç**~~ - **–ò–°–ü–†–ê–í–õ–ï–ù–û!**
4. ‚úÖ ~~**–û—à–∏–±–∫–∞ –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**~~ - **–ò–°–ü–†–ê–í–õ–ï–ù–û!**

## üéØ –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù–´! üéâ

1. ‚úÖ ~~**–°–Ω–∞—á–∞–ª–∞:** `add_task()`, `get_tasks()`, `get_today_tasks()`~~ - **–ì–û–¢–û–í–û!**
2. ‚úÖ ~~**–ó–∞—Ç–µ–º:** –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π (6 —Ñ—É–Ω–∫—Ü–∏–π)~~ - **–ì–û–¢–û–í–û!**
3. ‚úÖ ~~**–ü–æ—Ç–æ–º:** –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∫—É–ø–æ–∫ (4 —Ñ—É–Ω–∫—Ü–∏–∏)~~ - **–ì–û–¢–û–í–û!**
4. ‚úÖ ~~**–ü–æ—Å–ª–µ:** –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ (5 —Ñ—É–Ω–∫—Ü–∏–π)~~ - **–ì–û–¢–û–í–û!**
5. ‚úÖ ~~**–í –∫–æ–Ω—Ü–µ:** –ó–∞–º–µ—Ç–∫–∏ (1 —Ñ—É–Ω–∫—Ü–∏—è)~~ - **–ì–û–¢–û–í–û!**

**–í–°–ï 25 –§–£–ù–ö–¶–ò–ô –ò–°–ü–†–ê–í–õ–ï–ù–´ –ò –ì–û–¢–û–í–´ –ö –†–ê–ë–û–¢–ï!**