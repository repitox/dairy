# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## üö® –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ HTTP 500:

```
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: column "active" of relation "projects" does not exist
LINE 2: ...RT INTO projects (name, owner_id, color, created_at, active)
                                                                 ^
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `projects` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∫–æ–ª–æ–Ω–∫–∞ `active`, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (–¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
```sql
projects:
- id: integer
- name: text  
- color: text
- created_at: text
- owner_id: integer
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:
```sql
projects:
- id: integer
- name: text
- color: text  
- created_at: text
- owner_id: integer
- active: boolean (DEFAULT TRUE)
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. üîß –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏

**–§–∞–π–ª:** `add_active_column_migration.py`

```python
def add_active_column(conn):
    with conn.cursor() as cur:
        cur.execute("""
            ALTER TABLE projects 
            ADD COLUMN active BOOLEAN DEFAULT TRUE NOT NULL
        """)
        conn.commit()
```

### 2. üöÄ –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

```bash
ssh c107597@h60.netangels.ru "cd ~/rptx.na4u.ru && python3 ~/add_active_column_migration.py"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üöÄ –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ 'active' –≤ —Ç–∞–±–ª–∏—Ü—É projects
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

üìã –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã projects:
  - id: integer (default: None, nullable: YES)
  - name: text (default: None, nullable: YES)
  - color: text (default: None, nullable: YES)
  - created_at: text (default: None, nullable: YES)
  - owner_id: integer (default: None, nullable: NO)

üîß –ö–æ–ª–æ–Ω–∫–∞ 'active' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –≤—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é...
‚úÖ –ö–æ–ª–æ–Ω–∫–∞ 'active' –¥–æ–±–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
üìä –ö–æ–ª–æ–Ω–∫–∞ —Å–æ–∑–¥–∞–Ω–∞: active (boolean, default: true, nullable: NO)

üìã –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã projects:
  - id: integer (default: None, nullable: YES)
  - name: text (default: None, nullable: YES)
  - color: text (default: None, nullable: YES)
  - created_at: text (default: None, nullable: YES)
  - owner_id: integer (default: None, nullable: NO)
  - active: boolean (default: true, nullable: NO)

‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
```

### 3. üì¶ –î–µ–ø–ª–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

**–§–∞–π–ª:** `deploy_auth_fix.py`

–ó–∞–≥—Ä—É–∂–µ–Ω—ã —Ñ–∞–π–ª—ã:
- `db.py` - —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏—á–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- `bot.py` - —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

```bash
python3 deploy_auth_fix.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üöÄ –î–µ–ø–ª–æ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ db.py - —É—Å–ø–µ—à–Ω–æ
‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ bot.py - —É—Å–ø–µ—à–Ω–æ  
‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - —É—Å–ø–µ—à–Ω–æ
üéâ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!
```

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### –¢–∞–±–ª–∏—Ü–∞ `projects`:
```sql
CREATE TABLE projects (
    id INTEGER,
    name TEXT,
    color TEXT,
    created_at TEXT,
    owner_id INTEGER NOT NULL,
    active BOOLEAN DEFAULT TRUE NOT NULL
);
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:
1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram** - –±–µ–∑ –æ—à–∏–±–æ–∫ HTTP 500
2. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º –ª–∏—á–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤ –ë–î
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** - –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

### üîç –õ–æ–≥–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
ssh c107597@h60.netangels.ru "cd ~/rptx.na4u.ru && tail -f log/app-runlog/current"

# –ü—Ä–æ—Å–º–æ—Ç—Ä HTTP –ª–æ–≥–æ–≤
ssh c107597@h60.netangels.ru "cd ~/rptx.na4u.ru && tail -f log/rptx.na4u.ru-asgi.log"
```

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:

1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞** –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º
2. **–ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω** –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ
3. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ** –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
4. **–ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞** –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

### üîó –°—Å—ã–ª–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** https://rptx.na4u.ru/dashboard/index.html
- **–ì–ª–∞–≤–Ω–∞—è:** https://rptx.na4u.ru/dashboard/main.html

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏