<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .navigation-grid {
            display: grid;
            gap: 15px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .nav-item.inactive {
            opacity: 0.6;
            border-left-color: #95a5a6;
        }

        .nav-item.dashboard {
            border-left-color: #e74c3c;
        }

        .nav-item.webapp {
            border-left-color: #27ae60;
        }

        .nav-icon {
            font-size: 24px;
            margin-right: 15px;
        }

        .nav-details {
            flex: 1;
        }

        .nav-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .nav-url {
            color: #666;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .nav-meta {
            font-size: 12px;
            color: #999;
        }

        .nav-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .btn-toggle {
            background: #f39c12;
            color: white;
        }

        .btn-edit {
            background: #3498db;
            color: white;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn:hover {
            opacity: 0.8;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group textarea {
            height: 80px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .type-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 10px;
        }

        .type-webapp {
            background: #d5f4e6;
            color: #27ae60;
        }

        .type-dashboard {
            background: #fadbd8;
            color: #e74c3c;
        }

        .category-header {
            background: #ecf0f1;
            padding: 10px 15px;
            margin: 20px 0 10px 0;
            border-radius: 5px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 14px;
            color: #2c3e50;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #fadbd8;
            color: #e74c3c;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .success {
            background: #d5f4e6;
            color: #27ae60;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .preview-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .preview-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #ecf0f1;
        }

        .preview-box h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .preview-item {
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .preview-item .icon {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß≠ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π</h1>
            <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é –¥–ª—è Dashboard –∏ WebApp</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('list')">üìã –°–ø–∏—Å–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</button>
            <button class="tab" onclick="showTab('add')">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç</button>
            <button class="tab" onclick="showTab('preview')">üëÅÔ∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</button>
        </div>

        <div id="list-tab" class="tab-content active">
            <div id="loading" class="loading">
                <p>‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏...</p>
            </div>
            <div id="navigation-list" class="navigation-grid"></div>
        </div>

        <div id="add-tab" class="tab-content">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</h3>
            <form id="add-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—É–Ω–∫—Ç–∞ *</label>
                        <input type="text" id="title" name="title" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞">
                    </div>
                    <div class="form-group">
                        <label for="icon">–ò–∫–æ–Ω–∫–∞</label>
                        <input type="text" id="icon" name="icon" placeholder="üìä" maxlength="10">
                    </div>
                </div>

                <div class="form-group">
                    <label for="url">URL *</label>
                    <input type="text" id="url" name="url" required placeholder="analytics.html –∏–ª–∏ /dashboard/analytics.html">
                    <small>–î–ª—è WebApp –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏, –¥–ª—è Dashboard - –ø—É—Ç–∏ —Å /dashboard/</small>
                </div>

                <div class="form-group">
                    <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="description" name="description" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="category" name="category">
                            <option value="main">main - –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</option>
                            <option value="projects">projects - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏</option>
                            <option value="create">create - –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</option>
                            <option value="settings">settings - –ù–∞—Å—Ç—Ä–æ–π–∫–∏</option>
                            <option value="tools">tools - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</option>
                            <option value="admin">admin - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sort_order">–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
                        <input type="number" id="sort_order" name="sort_order" value="50" min="1" max="100">
                    </div>
                </div>

                <button type="submit" class="btn btn-edit">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç</button>
            </form>
        </div>

        <div id="preview-tab" class="tab-content">
            <h3>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</h3>
            <p>–ö–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≤ WebApp –∏ Dashboard</p>
            
            <button class="btn btn-edit" onclick="loadPreview()" style="margin-bottom: 20px;">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
            </button>
            
            <div class="preview-grid">
                <div class="preview-box">
                    <h4>üì± WebApp (Telegram)</h4>
                    <small style="color: #666;">–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–µ–∑ /dashboard/ –≤ URL</small>
                    <div id="webapp-preview" style="margin-top: 10px;"></div>
                </div>
                <div class="preview-box">
                    <h4>üñ•Ô∏è Dashboard (–ë—Ä–∞—É–∑–µ—Ä)</h4>
                    <small style="color: #666;">–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</small>
                    <div id="dashboard-preview" style="margin-top: 10px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let navigationData = [];

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±—ã
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // –ù–∞—Ö–æ–¥–∏–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É —Ç–∞–±–∞
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach((button, index) => {
                if ((tabName === 'list' && index === 0) ||
                    (tabName === 'add' && index === 1) ||
                    (tabName === 'preview' && index === 2)) {
                    button.classList.add('active');
                }
            });

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–∞–±–∞
            if (tabName === 'list') {
                loadNavigation();
            } else if (tabName === 'preview') {
                loadPreview();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        async function loadNavigation() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('navigation-list').innerHTML = '';

                const response = await fetch('/api/navigation?category=all');
                const data = await response.json();
                
                navigationData = data.navigation || [];
                renderNavigationList();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:', error);
                document.getElementById('navigation-list').innerHTML = 
                    '<div class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏: ' + error.message + '</div>';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function renderNavigationList() {
            const container = document.getElementById('navigation-list');
            
            if (navigationData.length === 0) {
                container.innerHTML = '<p>–ü—É–Ω–∫—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            const categories = {};
            navigationData.forEach(item => {
                const category = item.category || 'main';
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(item);
            });

            let html = '';
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            Object.keys(categories).sort().forEach(category => {
                html += `<div class="category-header">üìÇ ${category.toUpperCase()}</div>`;
                
                categories[category]
                    .sort((a, b) => a.sort_order - b.sort_order)
                    .forEach(item => {
                        const isActive = item.is_active !== false;
                        const isDashboard = item.url.startsWith('/dashboard/');
                        const typeClass = isDashboard ? 'dashboard' : 'webapp';
                        const typeLabel = isDashboard ? 'Dashboard' : 'WebApp';
                        const typeIndicator = isDashboard ? 'üñ•Ô∏è' : 'üì±';

                        html += `
                            <div class="nav-item ${typeClass} ${!isActive ? 'inactive' : ''}">
                                <div class="nav-icon">${item.icon || 'üìÑ'}</div>
                                <div class="nav-details">
                                    <div class="nav-title">
                                        ${item.title}
                                        <span class="type-indicator type-${isDashboard ? 'dashboard' : 'webapp'}">
                                            ${typeIndicator} ${typeLabel}
                                        </span>
                                    </div>
                                    <div class="nav-url">${item.url}</div>
                                    <div class="nav-meta">
                                        –ü–æ—Ä—è–¥–æ–∫: ${item.sort_order} | 
                                        ${item.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}
                                    </div>
                                </div>
                                <div class="nav-actions">
                                    <button class="btn btn-toggle" onclick="toggleNavItem(${item.id})">
                                        ${isActive ? '‚ùå –í—ã–∫–ª' : '‚úÖ –í–∫–ª'}
                                    </button>
                                    <button class="btn btn-delete" onclick="deleteNavItem(${item.id}, '${item.title}')">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        `;
                    });
            });

            container.innerHTML = html;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—É–Ω–∫—Ç–∞
        async function toggleNavItem(id) {
            try {
                const item = navigationData.find(item => item.id === id);
                if (!item) {
                    showMessage('‚ùå –ü—É–Ω–∫—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    return;
                }

                const newStatus = !item.is_active;
                
                console.log(`–ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –ø—É–Ω–∫—Ç ${id} (${item.title}) –Ω–∞ ${newStatus}`);
                
                const response = await fetch('/api/navigation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: id,
                        title: item.title,
                        url: item.url,
                        icon: item.icon,
                        description: item.description,
                        sort_order: item.sort_order,
                        category: item.category,
                        is_active: newStatus,
                        is_visible: item.is_visible
                    })
                });

                console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status);

                if (response.ok) {
                    const result = await response.json();
                    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
                    
                    item.is_active = newStatus;
                    renderNavigationList();
                    showMessage(`‚úÖ –ü—É–Ω–∫—Ç "${item.title}" ${newStatus ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω'}`, 'success');
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `HTTP ${response.status}`);
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ' + error.message, 'error');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—É–Ω–∫—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        async function deleteNavItem(id, title) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—É–Ω–∫—Ç "${title}"?`)) {
                return;
            }

            try {
                const response = await fetch('/api/navigation', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id: id })
                });

                if (response.ok) {
                    navigationData = navigationData.filter(item => item.id !== id);
                    renderNavigationList();
                    showMessage(`‚úÖ –ü—É–Ω–∫—Ç "${title}" —É–¥–∞–ª–µ–Ω`, 'success');
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
                }

            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—É–Ω–∫—Ç–∞
        document.getElementById('add-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º sort_order –≤ —á–∏—Å–ª–æ
            if (data.sort_order) {
                data.sort_order = parseInt(data.sort_order);
            }

            console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:', data);

            try {
                const response = await fetch('/api/navigation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status, response.statusText);

                if (response.ok) {
                    const result = await response.json();
                    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
                    
                    showMessage(`‚úÖ –ü—É–Ω–∫—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ "${data.title}" –¥–æ–±–∞–≤–ª–µ–Ω (ID: ${result.item_id})`, 'success');
                    e.target.reset();
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Å–ø–∏—Å–æ–∫ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º
                    setTimeout(() => {
                        showTab('list');
                    }, 1000);
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `HTTP ${response.status}`);
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ' + error.message, 'error');
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        async function loadPreview() {
            try {
                console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä...');
                
                const response = await fetch('/api/navigation?category=all');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('–î–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:', data);
                
                const allItems = data.navigation || [];
                console.log(`–í—Å–µ–≥–æ –ø—É–Ω–∫—Ç–æ–≤: ${allItems.length}`);
                
                // WebApp –Ω–∞–≤–∏–≥–∞—Ü–∏—è (–±–µ–∑ /dashboard/)
                const webappItems = allItems.filter(item => {
                    const isActive = item.is_active !== false;
                    const isWebApp = !item.url.startsWith('/dashboard/') && !item.url.includes('dashboard');
                    return isActive && isWebApp;
                });
                
                console.log(`WebApp –ø—É–Ω–∫—Ç–æ–≤: ${webappItems.length}`, webappItems.map(i => i.title));

                // Dashboard –Ω–∞–≤–∏–≥–∞—Ü–∏—è (–≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ)
                const dashboardItems = allItems.filter(item => item.is_active !== false);
                console.log(`Dashboard –ø—É–Ω–∫—Ç–æ–≤: ${dashboardItems.length}`, dashboardItems.map(i => i.title));

                renderPreview('webapp-preview', webappItems, 'WebApp');
                renderPreview('dashboard-preview', dashboardItems, 'Dashboard');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:', error);
                document.getElementById('webapp-preview').innerHTML = 
                    '<div class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message + '</div>';
                document.getElementById('dashboard-preview').innerHTML = 
                    '<div class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message + '</div>';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        function renderPreview(containerId, items, previewType) {
            const container = document.getElementById(containerId);
            
            console.log(`–†–µ–Ω–¥–µ—Ä–∏–º ${previewType} –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä:`, items);
            
            if (!items || items.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤</p>';
                return;
            }

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            const categories = {};
            items.forEach(item => {
                const category = item.category || 'main';
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(item);
            });

            let html = '';
            const sortedCategories = Object.keys(categories).sort();
            
            sortedCategories.forEach(category => {
                html += `<h5 style="margin: 15px 0 8px 0; color: #2c3e50; font-size: 13px;">üìÇ ${category.toUpperCase()}</h5>`;
                
                const sortedItems = categories[category].sort((a, b) => (a.sort_order || 0) - (b.sort_order || 0));
                
                sortedItems.forEach(item => {
                    const isDashboard = item.url.startsWith('/dashboard/');
                    const typeIcon = isDashboard ? 'üñ•Ô∏è' : 'üì±';
                    
                    html += `
                        <div class="preview-item" style="margin: 4px 0;">
                            <span class="icon" style="margin-right: 8px;">${typeIcon} ${item.icon || 'üìÑ'}</span>
                            <span style="flex: 1;">${item.title}</span>
                            <span style="font-size: 11px; color: #666; margin-left: 8px;">${item.url}</span>
                        </div>
                    `;
                });
            });

            container.innerHTML = html;
            console.log(`${previewType} –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω`);
        }

        // –ü–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏–π
        function showMessage(message, type) {
            const existingMessage = document.querySelector('.success, .error');
            if (existingMessage) {
                existingMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.innerHTML = message;
            
            document.querySelector('.container').insertBefore(messageDiv, document.querySelector('.tabs'));
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ URL
        document.getElementById('url').addEventListener('input', function(e) {
            const url = e.target.value;
            const isDashboard = url.startsWith('/dashboard/');
            
            // –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            const hint = isDashboard ? 
                'üñ•Ô∏è –≠—Ç–æ—Ç –ø—É–Ω–∫—Ç –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –≤ Dashboard' : 
                'üì± –≠—Ç–æ—Ç –ø—É–Ω–∫—Ç –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –≤ WebApp –∏ Dashboard';
            
            let hintElement = document.getElementById('url-hint');
            if (!hintElement) {
                hintElement = document.createElement('small');
                hintElement.id = 'url-hint';
                hintElement.style.color = isDashboard ? '#e74c3c' : '#27ae60';
                e.target.parentNode.appendChild(hintElement);
            }
            
            hintElement.textContent = hint;
            hintElement.style.color = isDashboard ? '#e74c3c' : '#27ae60';
        });

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadNavigation();
            // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            loadPreview();
        });
    </script>
</body>
</html>