<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Navigation Diagnostic</title>
    
    <!-- Preload API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <link rel="preload" href="/api/navigation?category=main" as="fetch" crossorigin>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="dashboard-styles.css">
    <link rel="stylesheet" href="navigation-api-simple.css">
    <link rel="stylesheet" href="ui-components.css">
    
    <style>
        .diagnostic-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .diagnostic-card {
            background: var(--glass-light);
            backdrop-filter: var(--blur-medium);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-large);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-light);
        }
        
        .diagnostic-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .diagnostic-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-success { background: var(--success, #28a745); }
        .status-error { background: var(--danger, #dc3545); }
        .status-warning { background: var(--warning, #ffc107); }
        .status-loading { 
            background: var(--primary, #007bff); 
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .diagnostic-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .diagnostic-row:last-child {
            border-bottom: none;
        }
        
        .diagnostic-label {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .diagnostic-value {
            color: var(--text-secondary);
            font-family: monospace;
        }
        
        .page-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .page-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background: var(--glass-medium);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-medium);
            text-decoration: none;
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }
        
        .page-link:hover {
            background: var(--glass-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .navigation-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-small);
            font-size: 14px;
        }
        
        .error-details {
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid rgba(220, 53, 69, 0.3);
            border-radius: var(--radius-small);
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            color: var(--danger);
        }
    </style>
</head>

<body>
    <!-- API –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
    
    <div class="diagnostic-container">
        
        <div class="diagnostic-card">
            <div class="diagnostic-header">
                <h1 class="diagnostic-title">üîç API Navigation System - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h1>
                <span class="status-indicator status-loading" id="overall-status"></span>
            </div>
            
            <div class="diagnostic-row">
                <span class="diagnostic-label">–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞:</span>
                <span class="diagnostic-value" id="start-time">-</span>
            </div>
            
            <div class="diagnostic-row">
                <span class="diagnostic-label">–°—Ç–∞—Ç—É—Å API:</span>
                <span class="diagnostic-value" id="api-status">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</span>
            </div>
            
            <div class="diagnostic-row">
                <span class="diagnostic-label">–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:</span>
                <span class="diagnostic-value" id="nav-load-time">-</span>
            </div>
            
            <div class="diagnostic-row">
                <span class="diagnostic-label">–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:</span>
                <span class="diagnostic-value" id="data-source">-</span>
            </div>
            
            <div class="diagnostic-row">
                <span class="diagnostic-label">–ö–µ—à —Å—Ç–∞—Ç—É—Å:</span>
                <span class="diagnostic-value" id="cache-status">-</span>
            </div>
        </div>
        
        <div class="diagnostic-card">
            <div class="diagnostic-header">
                <h2 class="diagnostic-title">üìä –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã</h2>
                <span class="status-indicator status-loading" id="nav-items-status"></span>
            </div>
            
            <div class="diagnostic-row">
                <span class="diagnostic-label">–í—Å–µ–≥–æ –ø—É–Ω–∫—Ç–æ–≤:</span>
                <span class="diagnostic-value" id="nav-count">-</span>
            </div>
            
            <div class="diagnostic-row">
                <span class="diagnostic-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤:</span>
                <span class="diagnostic-value" id="nav-active-count">-</span>
            </div>
            
            <div class="navigation-items" id="navigation-items">
                <!-- –ü—É–Ω–∫—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <div class="diagnostic-card">
            <div class="diagnostic-header">
                <h2 class="diagnostic-title">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü</h2>
            </div>
            
            <p>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ API –Ω–∞–≤–∏–≥–∞—Ü–∏—é –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö dashboard:</p>
            
            <div class="page-links">
                <a href="/dashboard/main.html" class="page-link">
                    üè† <span>–ì–ª–∞–≤–Ω–∞—è</span>
                </a>
                <a href="/dashboard/tasks.html" class="page-link">
                    üìã <span>–ó–∞–¥–∞—á–∏</span>
                </a>
                <a href="/dashboard/meetings.html" class="page-link">
                    üìÖ <span>–í—Å—Ç—Ä–µ—á–∏</span>
                </a>
                <a href="/dashboard/projects.html" class="page-link">
                    üìÅ <span>–ü—Ä–æ–µ–∫—Ç—ã</span>
                </a>
                <a href="/dashboard/shopping.html" class="page-link">
                    üõí <span>–ü–æ–∫—É–ø–∫–∏</span>
                </a>
                <a href="/dashboard/notes.html" class="page-link">
                    üìù <span>–ó–∞–º–µ—Ç–∫–∏</span>
                </a>
                <a href="/dashboard/settings.html" class="page-link">
                    ‚öôÔ∏è <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </a>
                <a href="/dashboard/ui-kit.html" class="page-link">
                    üé® <span>UI Kit</span>
                </a>
            </div>
        </div>
        
        <div class="diagnostic-card" id="error-card" style="display: none;">
            <div class="diagnostic-header">
                <h2 class="diagnostic-title">‚ùå –û—à–∏–±–∫–∏</h2>
            </div>
            <div class="error-details" id="error-details">
                <!-- –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="auth.js"></script>
    <script src="navigation-api-loader.js"></script>
    
    <script>
        // –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
        const diagnostic = {
            startTime: Date.now(),
            errors: [],
            navLoadStartTime: null,
            navLoadEndTime: null
        };
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—É—Å–∫–∞
        document.getElementById('start-time').textContent = new Date().toLocaleTimeString();
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            const statusEl = document.getElementById(elementId.replace('-status', '') + '-status');
            
            if (element) element.textContent = message;
            
            if (statusEl) {
                statusEl.className = 'status-indicator ' + 
                    (status === 'success' ? 'status-success' : 
                     status === 'error' ? 'status-error' : 
                     status === 'warning' ? 'status-warning' : 'status-loading');
            }
        }
        
        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –Ω–∞–ø—Ä—è–º—É—é
        async function testApiDirect() {
            try {
                diagnostic.navLoadStartTime = Date.now();
                
                const response = await fetch('/api/navigation?category=main');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                diagnostic.navLoadEndTime = Date.now();
                
                const loadTime = diagnostic.navLoadEndTime - diagnostic.navLoadStartTime;
                
                updateStatus('api-status', 'success', '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç');
                document.getElementById('nav-load-time').textContent = `${loadTime}–º—Å`;
                document.getElementById('data-source').textContent = 'üåê API –ë–î';
                document.getElementById('nav-count').textContent = data.total_items;
                document.getElementById('nav-active-count').textContent = data.navigation.length;
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—É–Ω–∫—Ç–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                const navItemsContainer = document.getElementById('navigation-items');
                navItemsContainer.innerHTML = '';
                
                data.navigation.forEach(item => {
                    const navItem = document.createElement('div');
                    navItem.className = 'nav-item';
                    navItem.innerHTML = `
                        <span>${item.icon}</span>
                        <span>${item.title}</span>
                    `;
                    navItemsContainer.appendChild(navItem);
                });
                
                updateStatus('nav-items-status', 'success', '');
                
                return data;
                
            } catch (error) {
                diagnostic.errors.push(`API Test: ${error.message}`);
                updateStatus('api-status', 'error', `‚ùå ${error.message}`);
                updateStatus('nav-items-status', 'error', '');
                document.getElementById('data-source').textContent = '‚ùå –û—à–∏–±–∫–∞';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Å –æ—à–∏–±–∫–∞–º–∏
                document.getElementById('error-card').style.display = 'block';
                document.getElementById('error-details').textContent = error.message;
                
                throw error;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞
        function checkCache() {
            try {
                const cached = null;
                if (cached) {
                    const data = JSON.parse(cached);
                    const age = Date.now() - data.timestamp;
                    const ageMinutes = Math.floor(age / 1000 / 60);
                    
                    document.getElementById('cache-status').textContent = 
                        `üíæ –ö–µ—à (${ageMinutes} –º–∏–Ω. –Ω–∞–∑–∞–¥)`;
                } else {
                    document.getElementById('cache-status').textContent = 'üóëÔ∏è –ü—É—Å—Ç–æ–π';
                }
            } catch (error) {
                document.getElementById('cache-status').textContent = '‚ùå –û—à–∏–±–∫–∞ –∫–µ—à–∞';
                diagnostic.errors.push(`Cache Check: ${error.message}`);
            }
        }
        
        // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.addEventListener('apiNavigationLoaded', function(event) {
            console.log('üéâ –ù–∞–≤–∏–≥–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ loader:', event.detail);
            
            updateStatus('overall-status', 'success', '');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–≤–ø–∞–¥–∞—é—Ç –ª–∏ –¥–∞–Ω–Ω—ã–µ
            const loaderItems = event.detail.navigationItems;
            document.getElementById('nav-count').textContent = loaderItems.length;
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        async function initDiagnostic() {
            console.log('üîç –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ API Navigation System');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à
            checkCache();
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º API –Ω–∞–ø—Ä—è–º—É—é
            try {
                await testApiDirect();
                console.log('‚úÖ –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç API —É—Å–ø–µ—à–µ–Ω');
            } catch (error) {
                console.error('‚ùå –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç API failed:', error);
            }
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ loader
            setTimeout(() => {
                if (document.getElementById('overall-status').className.includes('loading')) {
                    updateStatus('overall-status', 'warning', '');
                    diagnostic.errors.push('Navigation Loader: Timeout –ø–æ—Å–ª–µ 5 —Å–µ–∫—É–Ω–¥');
                    
                    if (diagnostic.errors.length > 0) {
                        document.getElementById('error-card').style.display = 'block';
                        document.getElementById('error-details').innerHTML = 
                            diagnostic.errors.map(err => `‚Ä¢ ${err}`).join('<br>');
                    }
                }
            }, 5000);
        }
        
        // –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDiagnostic);
        } else {
            initDiagnostic();
        }
    </script>
</body>

</html>