# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 422 –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∑–∞–¥–∞—á–∞–º–∏

## üìã –ü—Ä–æ–±–ª–µ–º–∞
–û—à–∏–±–∫–∞ `HTTP 422` –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–¥–∞—á–∏:
```
GET /api/tasks/15?user_id=undefined
```

–ü–∞—Ä–∞–º–µ—Ç—Ä `user_id` –±—ã–ª `undefined` –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `getUserId()` –≤—ã–∑—ã–≤–∞–ª–∞—Å—å **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp.

---

## üîß –†–µ—à–µ–Ω–∏–µ

### 1Ô∏è‚É£ Frontend (3 —Ñ–∞–π–ª–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**`/static/task.html`** - –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞—á–∏
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π `getUserId()` –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π `await getDbUserId()`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω endpoint: `/api/tasks?user_id=` ‚Üí `/api/tasks/{id}?user_id=`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `user_id` –≤–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã (DELETE, PUT, POST)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å emoji (üìã‚úÖ‚ùå)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ try-catch –±–ª–æ–∫–∞—Ö

**`/static/task_edit.html`** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
- ‚úÖ `await getDbUserId()` —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ `window.taskUserId`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã endpoints
- ‚úÖ `user_id` –¥–æ–±–∞–≤–ª–µ–Ω –≤ PUT body –∏ query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**`/static/task_add.html`** - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
- ‚úÖ `await getDbUserId()` –≤ `loadProjects()`
- ‚úÖ `await getDbUserId()` –≤ `handleSubmit()`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ `userId` –Ω–µ undefined –ø–µ—Ä–µ–¥ API –∑–∞–ø—Ä–æ—Å–æ–º
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 2Ô∏è‚É£ Backend (1 —Ñ–∞–π–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**`/app/api/tasks.py`** - API endpoints
- ‚úÖ `PUT /tasks/{task_id}` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `user_id` –∏–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ `POST /tasks/{task_id}/toggle` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `user_id` –∏–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ `DELETE /tasks/{task_id}` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `user_id` –∏–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ Endpoints —Ç–µ–ø–µ—Ä—å –≥–∏–±–∫–∏–µ - –ø—Ä–∏–Ω–∏–º–∞—é—Ç `user_id` –∏–∑ –¥–≤—É—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
  - Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `/api/tasks/15?user_id=123`
  - JSON body: `{"user_id": 123, ...}`

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```
–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ: 4
‚îú‚îÄ‚îÄ Frontend: 3 —Ñ–∞–π–ª–∞ (.html)
‚îî‚îÄ‚îÄ Backend: 1 —Ñ–∞–π–ª (.py)

–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ: ~150
‚îú‚îÄ‚îÄ /static/task.html: ~60 —Å—Ç—Ä–æ–∫
‚îú‚îÄ‚îÄ /static/task_edit.html: ~35 —Å—Ç—Ä–æ–∫
‚îú‚îÄ‚îÄ /static/task_add.html: ~30 —Å—Ç—Ä–æ–∫
‚îî‚îÄ‚îÄ /app/api/tasks.py: ~15 —Å—Ç—Ä–æ–∫

–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
‚úÖ 4x async/await –¥–æ–±–∞–≤–ª–µ–Ω–æ (–≤–º–µ—Å—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ getUserId)
‚úÖ 3x endpoint –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
‚úÖ 8x user_id –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∑–∞–ø—Ä–æ—Å—ã
‚úÖ 12x –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
‚úÖ 10x –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —É–ª—É—á—à–µ–Ω–∞
```

---

## üéØ –ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç

**–ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```javascript
const res = await fetch(`/api/tasks?user_id=${getUserId()}`);
// getUserId() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç undefined 422 ERROR!
```

**–°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```javascript
const userId = await getDbUserId();  // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∂–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
if (!userId) { show error; return; }
const res = await fetch(`/api/tasks/${taskId}?user_id=${userId}`);
// –í—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ! 200 OK
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
```javascript
await getDbUserId()
// –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —á–∏—Å–ª–æ (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
// –ù–∞–ø—Ä–∏–º–µ—Ä: 123
```

### –õ–æ–≥–∏
```
üìã –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞—á—É ID: 15
‚úÖ User ID –ø–æ–ª—É—á–µ–Ω: 123
‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
```

---

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–û
- ‚ùå HTTP 422 (undefined user_id)
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint
- ‚ùå –ù–µ—Ç user_id –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
- ‚ùå –ü–ª–æ—Ö–∏–µ –ª–æ–≥–∏
- ‚ùå –ü–ª–æ—Ö–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ü–û–°–õ–ï
- ‚úÖ HTTP 200 OK
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ endpoints
- ‚úÖ user_id –≤–µ–∑–¥–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ —Å emoji
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é!

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
scp /Users/d.dubenetskiy/Documents/tg_project/static/task*.html user@server:/app/static/
scp /Users/d.dubenetskiy/Documents/tg_project/app/api/tasks.py user@server:/app/app/api/

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
ssh user@server "systemctl restart my-app"
```

---

## üìù –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã

1. `/static/task.html` - **–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª** (~60 —Å—Ç—Ä–æ–∫)
2. `/static/task_edit.html` - **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (~35 —Å—Ç—Ä–æ–∫)
3. `/static/task_add.html` - **–°–æ–∑–¥–∞–Ω–∏–µ** (~30 —Å—Ç—Ä–æ–∫)
4. `/app/api/tasks.py` - **Backend** (~15 —Å—Ç—Ä–æ–∫)

‚úÖ **–°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û –ö –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Æ**